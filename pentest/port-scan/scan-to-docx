#!/usr/bin/env python3

import socket
import platform
from docx import Document
from datetime import datetime

def is_port_open(host, port):
    """Determines whether the host has the port open."""
    # Creates a new socket
    s = socket.socket()
    try:
        # Tries to connect to host using that port
        s.connect((host, port))
        # Make a timeout if you want it a little faster (means less accuracy)
        # s.settimeout(0.2) <-- if you want to add a timeout
        s.close()  # Close the socket after a successful connection
        return True
    except:
        # Cannot connect (port is closed) and returns false
        return False

# Asks the user to enter a host
host = input("Enter the host: ")
# Asks the user to enter the maximum port to scan
max_port = int(input("Enter the maximum port to scan: "))

# Get system information
system_info = platform.uname()

# Create a new Word document
doc = Document()
doc.add_heading(f"Penetration Test Report for {host} - {datetime.now().strftime('%Y-%m-%d')}", level=1)

# Write system information
doc.add_heading("System Information", level=2)
doc.add_paragraph(f"System: {system_info.system}")
doc.add_paragraph(f"Node Name: {system_info.node}")
doc.add_paragraph(f"Release: {system_info.release}")
doc.add_paragraph(f"Version: {system_info.version}")
doc.add_paragraph(f"Machine: {system_info.machine}")
doc.add_paragraph(f"Processor: {system_info.processor}")

# Write configuration of the system performing the penetration test
doc.add_heading("Penetration Test Configuration", level=2)
doc.add_paragraph(f"Host: {host}")
doc.add_paragraph(f"Maximum Port to Scan: {max_port}")

# Variables to keep track of the range of closed ports
start_closed_port = None

# Scan ports from 1 to the maximum port specified
for port in range(1, max_port + 1):
    if is_port_open(host, port):
        if start_closed_port is not None:
            closed_range = f"{start_closed_port} - {port - 1}"
            doc.add_paragraph(f"Closed Ports: {closed_range}")
            start_closed_port = None
        doc.add_paragraph(f"Port {port}: Open")
    else:
        if start_closed_port is None:
            start_closed_port = port

# Check if the last port in the range is closed
if start_closed_port is not None:
    closed_range = f"{start_closed_port} - {max_port}"
    doc.add_paragraph(f"Closed Ports: {closed_range}")

# Disclaimer text (customize as needed)
disclaimer_text = "The findings in this report are for authorized use only. The methodologies used are intended for educational purposes and should not be used maliciously."

# Add disclaimer section
doc.add_heading('Disclaimer', level=1)
doc.add_paragraph(disclaimer_text)

# Save the Word document
doc.save(f"penetration_test_report_{datetime.now().strftime('%Y-%m-%d_%H-%M-%S')}.docx")
print("Penetration test report saved.")
